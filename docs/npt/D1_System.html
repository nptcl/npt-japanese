<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Lisp関数仕様 - システム関数</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Lisp関数仕様 - システム関数</h1>
</header>
<p>nptのドキュメントです。<br />
参照元：<a href="index.html">ANSI Common Lisp npt</a></p>
<h1 id="lisp関数仕様">Lisp関数仕様</h1>
<p><code>npt-system</code>パッケージの下記の関数を説明します。</p>
<ul>
<li><a href="#system-call-1">システム関数</a></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> gc</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> savecore</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> exit</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> quit</span></span></code></pre></div>
<ul>
<li><a href="#system-call-2">オブジェクト確認</a></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> specialp</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-general-p</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-specialized-p</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> closp</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> fixnump</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> bignump</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> ratiop</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> short-float-p</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> single-float-p</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> double-float-p</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> long-float-p</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> callnamep</span></span></code></pre></div>
<ul>
<li><a href="#system-call-3">オブジェクト生成</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-character</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-fixnum</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-bignum</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-ratio</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-complex</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-callname</span></span></code></pre></div>
<ul>
<li><a href="#system-call-4">型確認</a></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> subtypep</span>!</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> parse-type</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> type-object</span></span></code></pre></div>
<ul>
<li><a href="#system-call-5">メモリストリーム</a></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-input-stream</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-output-stream</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-io-stream</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defmacro</span><span class="fu"> with-input-from-memory</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defmacro</span><span class="fu"> with-output-to-memory</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> get-output-stream-memory</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> memory-stream-p</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> </span>(<span class="kw">setf</span> memory-stream-p)</span></code></pre></div>
<ul>
<li><a href="#system-call-6">ソート</a></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> simple-sort</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> bubble-sort</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> quick-sort</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> merge-sort</span></span></code></pre></div>
<ul>
<li><a href="#system-call-7">Paperオブジェクト</a></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-paper</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> info-paper</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-paper</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> body-paper</span></span></code></pre></div>
<ul>
<li><a href="#system-call-8">その他の関数</a></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> package-export-list</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> large-number</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> equal-random-state</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> remove-file</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> remove-directory</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> byte-integer</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> fpclassify</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-set</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-get</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-width</span></span></code></pre></div>
<h1 id="システム関数"><a id="system-call-1">■システム関数</a></h1>
<p><code>npt-system</code>パッケージに存在する、システム関数の関数仕様を示します。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> gc</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> savecore</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> exit</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> quit</span></span></code></pre></div>
<h2 id="関数gc">関数<code>gc</code></h2>
<p>ガベージコレクタを起動します。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> gc </span>(&amp;key full) ...) -&gt; <span class="kw">null</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>入力: full general-boolean</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">null</span> nil固定</span></code></pre></div>
<p>本関数は、ガベージコレクタの依頼を行います。<br />
関数内でガベージコレクタが実行されるのではなく、 処理系の都合の良いタイミングで実施されます。<br />
現時点では引数<code>:full</code>は無視されます。<br />
ガベージコレクタの実行は<code>room</code>関数で確認できます。</p>
<h3 id="実行例">実行例</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">room</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>・・・</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>GC count:           <span class="dv">1</span>                   [times]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>・・・</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (npt-system:gc)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">room</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>・・・</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>GC count:           <span class="dv">2</span>                   [times]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>・・・</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="op">*</span></span></code></pre></div>
<h2 id="関数savecore">関数<code>savecore</code></h2>
<p>Lispを終了させてから、コアファイルを作成します。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> savecore </span>(pathname-designer) ...) -&gt; <span class="kw">null</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>入力: pathname-designer 出力先パス</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">null</span> 戻り値無し</span></code></pre></div>
<p>コアファイルとは、メモリイメージを出力したファイルです。<br />
npt起動時に<code>--core</code>引数および<code>--corefile</code>引数を指定すると、 コアファイルを読み込めます。</p>
<p><code>savecore</code>関数は<code>savecore condition</code>を実行してLispを終了させます。<br />
途中で<code>handler</code>を捕捉することができます。</p>
<p>本関数が正常に動作した場合はLispが終了するので、 通常はプロセス自体が終了します。<br />
モジュールとして使用している場合は、C言語の<code>lisp_argv_run</code>関数から制御が戻ります。</p>
<h3 id="実行例-1">実行例</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>$ npt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">defvar</span><span class="fu"> *hello* </span><span class="dv">1234</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>*HELLO*</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> *hello*</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1234</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (npt-system:savecore #p<span class="st">&quot;hello-core-image.core&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>Core file: hello-core-image.core</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>$ ls</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>hello-core-image.core</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>$ npt --core --corefile hello-core-image.core</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> *hello*</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1234</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="op">*</span></span></code></pre></div>
<h2 id="関数exit">関数<code>exit</code></h2>
<h2 id="関数quit">関数<code>quit</code></h2>
<p>Lispを終了します。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> exit </span>(&amp;optional code) ...) -&gt; なし</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> quit </span>(&amp;optional code) ...) -&gt; なし</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>入力: code 終了コード、省略時は0</span></code></pre></div>
<p><code>exit</code>と<code>quit</code>は同じです。</p>
<p>本関数はLispを終了させますので、式の返却値はありません。<br />
引数の終了コードは、通常はプロセスの終了コードに設定されます。<br />
モジュールとして使用している場合は、C言語の<code>lisp_argv_run</code>関数から制御が戻ります。<br />
返却値は<code>lisp_result</code>変数で確認できます。</p>
<p><code>exit</code>/<code>quit</code>は<code>exit condition</code>を実行してLispを終了させます。<br />
途中で<code>handler</code>を捕捉することができます。</p>
<p><code>exit</code>と<code>quit</code>の<code>symbol</code>は、<code>common-lisp-user</code>パッケージに <code>import</code>された状態で始まります。</p>
<h3 id="実行例-2">実行例</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>$ npt</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (quit)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>$ echo $?</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>$ npt --eval &#39;(exit <span class="dv">22</span>)&#39;</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>$ echo $?</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dv">22</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>$</span></code></pre></div>
<h1 id="オブジェクト確認"><a id="system-call-2">■オブジェクト確認</a></h1>
<p><code>npt-system</code>パッケージに存在する、オブジェクト確認の関数仕様を示します。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> specialp</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-general-p</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-specialized-p</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> closp</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> fixnump</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> bignump</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> ratiop</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> short-float-p</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> single-float-p</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> double-float-p</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> long-float-p</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> callnamep</span></span></code></pre></div>
<h2 id="関数specialp">関数<code>specialp</code></h2>
<p>グローバル変数がspecialかどうかを調査します。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> specialp </span>(<span class="kw">symbol</span>) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">symbol</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>レキシカルの状況を考慮せず、変数がspecialかどうかを返却します。<br />
つまり変数が<code>defvar</code>, <code>defparameter</code>, <code>declaim</code>, <code>proclaim</code>の実行により special変数になった場合に<code>t</code>となります。</p>
<h3 id="実行例-3">実行例</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (specialp &#39;aaa)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">defvar</span><span class="fu"> bbb</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>BBB</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (specialp &#39;bbb)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">let</span> (ccc) (<span class="kw">declare</span> (<span class="kw">special</span> ccc)) (specialp &#39;ccc))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>NIL</span></code></pre></div>
<h2 id="関数array-general-p">関数<code>array-general-p</code></h2>
<p>引数がgeneral arrayかどうかを調べます。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> array-general-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>array</code>オブジェクトであり、かつgeneral arrayの場合は<code>t</code>を返却します。<br />
<code>typep</code>とは違い、npt内部のオブジェクト種別によって判定が変わります。<br />
入力が<code>make-array</code>によって生成され、 かつ<code>element-type</code>が<code>t</code>のオブジェクトの場合に限り<code>t</code>が返却されます。<br />
例えば<code>#(10 20 30)</code>は、<code>vector</code>オブジェクトのため、<code>t</code>にはなりません。</p>
<h3 id="実行例-4">実行例</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (array-general-p (<span class="kw">make-array</span> <span class="dv">10</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (array-general-p #(<span class="dv">10</span> <span class="dv">20</span> <span class="dv">30</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">typep</span> (<span class="kw">make-array</span> <span class="dv">10</span>) &#39;(<span class="kw">array</span> <span class="kw">t</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">typep</span> #(<span class="dv">10</span> <span class="dv">20</span> <span class="dv">30</span>) &#39;(<span class="kw">array</span> <span class="kw">t</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数array-specialized-p">関数<code>array-specialized-p</code></h2>
<p>引数がspecialized arrayかどうかを調べます。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> array-specialized-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>array</code>オブジェクトであり、 かつ<code>element-type</code>が<code>t</code>以外の場合は<code>t</code>が返却されます。</p>
<h2 id="関数closp">関数<code>closp</code></h2>
<p>引数が<code>clos</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> closp </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>clos</code>オブジェクトの場合は<code>t</code>が返却されます。<br />
Common Lispでは、全てのCLOSオブジェクトが <code>standard-object</code>に属しているため、 通常であれば次の命令と一致するはずです。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">typep</span> 入力 &#39;standard-object)</span></code></pre></div>
<h2 id="関数fixnump">関数<code>fixnump</code></h2>
<p>引数が<code>fixnum</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> fixnump </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>fixnum</code>オブジェクトの場合は<code>t</code>が返却されます。<br />
通常であれば、<code>fixnum</code>型に属する<code>integer</code>は 全て<code>fixnum</code>オブジェクトであるはずです。<br />
しかし開発においては、例えば<code>bignum</code>型であるにもかかわらず、 <code>10</code>や<code>20</code>と言った小さな<code>integer</code>も作成できます。<br />
本関数は上記の差異を調査するためのものです。</p>
<h3 id="実行例-5">実行例</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> <span class="dv">10</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (fixnump <span class="dv">10</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-bignum <span class="dv">20</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (fixnump (make-bignum <span class="dv">20</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>NIL</span></code></pre></div>
<h2 id="関数bignump">関数<code>bignump</code></h2>
<p>引数が<code>bignum</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> bignump </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>bignum</code>オブジェクトの場合は<code>t</code>が返却されます。</p>
<h3 id="実行例-6">実行例</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> <span class="dv">10</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (bignump <span class="dv">10</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-bignum <span class="dv">20</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">20</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (bignump (make-bignum <span class="dv">20</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数ratiop">関数<code>ratiop</code></h2>
<p>引数が<code>ratio</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> ratiop </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力が<code>ratio</code>オブジェクトの場合は<code>t</code>が返却されます。<br />
通常であれば、分母が<code>1</code>の分数は<code>integer</code>型であるはずです。<br />
しかし開発においては、例えば<code>100/1</code>が<code>ratio</code>オブジェクトで存在する場合があります。<br />
本関数は上記の差異を調査するためのものです。</p>
<h3 id="実行例-7">実行例</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> <span class="dv">10</span>/<span class="dv">5</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (ratiop <span class="dv">10</span>/<span class="dv">5</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-ratio <span class="dv">10</span> <span class="dv">5</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>/<span class="dv">5</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (ratiop (make-ratio <span class="dv">10</span> <span class="dv">5</span>))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数short-float-p">関数<code>short-float-p</code></h2>
<p>引数が<code>short-float</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> short-float-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>現在、nptでは<code>short-float</code>オブジェクトを生成する方法はありません。</p>
<h2 id="関数single-float-p">関数<code>single-float-p</code></h2>
<p>引数が<code>single-float</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> single-float-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<h2 id="関数double-float-p">関数<code>double-float-p</code></h2>
<p>引数が<code>double-float</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> double-float-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<h2 id="関数long-float-p">関数<code>long-float-p</code></h2>
<p>引数が<code>long-float</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> long-float-p </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<h2 id="関数callnamep">関数<code>callnamep</code></h2>
<p>引数が<code>callname</code>オブジェクトかどうかを調べます。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> callnamep </span>(object) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p><code>callname</code>とは、関数名を表すオブジェクトであり、 通常の<code>car</code>と言った<code>symbol</code>と、 setf関数を表す<code>(setf car)</code>形式をまとめたものです。<br />
Common Lispにおいて、<code>callname</code>オブジェクトを生成する方法はありません。</p>
<h1 id="オブジェクト生成"><a id="system-call-3">■オブジェクト生成</a></h1>
<p><code>npt-system</code>パッケージに存在する、オブジェクト生成の関数仕様を示します。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-character</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-fixnum</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-bignum</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-ratio</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-complex</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-callname</span></span></code></pre></div>
<h2 id="関数make-character">関数<code>make-character</code></h2>
<p><code>character</code>オブジェクトを複製します。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-character </span>(<span class="kw">character</span>) ...) -&gt; <span class="kw">character</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">character</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">character</span></span></code></pre></div>
<p>入力で受け取った文字オブジェクトを複製して返却します。<br />
本関数の目的は、キャッシュを避けて新規オブジェクトを生成することです。<br />
nptでは、文字コードが<code>#x80</code>未満であれば同一のオブジェクトが返却されます。<br />
よって、<code>eq</code>は一致します。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="ch">#\A</span> <span class="ch">#\A</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="ch">#\A</span> (<span class="kw">read-from-string</span> <span class="st">&quot;</span><span class="ch">#\\</span><span class="st">A&quot;</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<p>もし違うオブジェクトが必要なときは本関数で複製します。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="ch">#\A</span> (make-character <span class="ch">#\A</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eql</span> <span class="ch">#\A</span> (make-character <span class="ch">#\A</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数make-fixnum">関数<code>make-fixnum</code></h2>
<p><code>fixnum</code>オブジェクトを複製します。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-fixnum </span>(<span class="kw">fixnum</span>) ...) -&gt; <span class="kw">fixnum</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">fixnum</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">fixnum</span></span></code></pre></div>
<p>入力で受け取った<code>fixnum</code>オブジェクトを複製して返却します。<br />
本関数の目的は、キャッシュを避けて新規オブジェクトを生成することです。<br />
nptでは、値が<code>-1024</code>から<code>+1024</code>の整数であれば、 同一のオブジェクトが返却されます。<br />
よって、<code>eq</code>は一致します。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="dv">11</span> <span class="dv">11</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="dv">11</span> (<span class="kw">read-from-string</span> <span class="st">&quot;11&quot;</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<p>もし違うオブジェクトが必要なときは本関数で複製します。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eq</span> <span class="dv">11</span> (make-fixnum <span class="dv">11</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">eql</span> <span class="dv">11</span> (make-fixnum <span class="dv">11</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数make-bignum">関数<code>make-bignum</code></h2>
<p><code>bignum</code>オブジェクトを生成します。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-bignum </span>(<span class="kw">integer</span>) ...) -&gt; <span class="kw">bignum</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">integer</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">bignum</span></span></code></pre></div>
<p>入力で受け取った整数値から<code>bignum</code>オブジェクトを生成します。<br />
本関数の目的は、小さな整数値の<code>bignum</code>オブジェクトを生成することです。<br />
通常であれば、例えば<code>10</code>や<code>2000</code>と言った整数は、 <code>fixnum</code>オブジェクトが返却されます。<br />
本関数は強制的に<code>bignum</code>オブジェクトを生成するときに使用します。</p>
<p>★注意<br />
nptでは、本来<code>fixnum</code>の範囲にある整数が <code>bignum</code>オブジェクトで渡されることを想定していません。<br />
本関数を用いて実施した結果については全て未定義です。</p>
<h3 id="実行例-8">実行例</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> <span class="dv">10</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-bignum <span class="dv">10</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (fixnump <span class="dv">10</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (bignump <span class="dv">10</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (fixnump (make-bignum <span class="dv">10</span>))</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (bignump (make-bignum <span class="dv">10</span>))</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数make-ratio">関数<code>make-ratio</code></h2>
<p><code>ratio</code>オブジェクトを生成します。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-ratio </span>(numer denom) ...) -&gt; <span class="kw">ratio</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>入力: numer 分子を表すintegerオブジェクト</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>入力: denom 分母を表すintegerオブジェクト</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">ratio</span></span></code></pre></div>
<p>入力で受け取った整数<code>numer</code>, <code>denom</code>から、<code>ratio</code>オブジェクトを生成します。<br />
本関数の目的は、約分を無視して<code>ratio</code>オブジェクトを生成することです。<br />
通常であれば、例えば<code>10/5</code>と言った分数は、 約分されて<code>2</code>という<code>fixnum</code>オブジェクトが返却されます。<br />
本関数は強制的に<code>ratio</code>オブジェクトを生成するときに使用します。</p>
<p>★注意<br />
nptでは、本来<code>integer</code>となるものが<code>ratio</code>オブジェクトで渡されることを想定していません。<br />
本関数を用いて実施した結果については全て未定義です。</p>
<h3 id="実行例-9">実行例</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> <span class="dv">10</span>/<span class="dv">5</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (ratiop <span class="dv">10</span>/<span class="dv">5</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-ratio <span class="dv">10</span> <span class="dv">5</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>/<span class="dv">5</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (ratiop (make-ratio <span class="dv">10</span> <span class="dv">5</span>))</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数make-complex">関数<code>make-complex</code></h2>
<p><code>complex</code>オブジェクトを生成します。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-complex </span>(<span class="kw">real</span> imag) ...) -&gt; <span class="kw">complex</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">real</span> 実数を表すrealオブジェクト</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>入力: imag 虚数を表すrealオブジェクト</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">complex</span></span></code></pre></div>
<p>入力で受け取った整数<code>real</code>, <code>imag</code>から、<code>complex</code>オブジェクトを生成します。<br />
本関数の目的は、虚数が<code>0</code>の整数型<code>complex</code>オブジェクトを生成することです。<br />
通常であれば、例えば<code>#c(10 0)</code>と言った数は、 <code>10</code>という<code>fixnum</code>オブジェクトが返却されます。<br />
本関数は強制的に<code>complex</code>オブジェクトを生成するときに使用します。</p>
<p>★注意<br />
nptでは、本来<code>integer</code>となるものが<code>complex</code>オブジェクトで渡されることを想定していません。<br />
本関数を用いて実施した結果については全て未定義です。</p>
<h3 id="実行例-10">実行例</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> #c(<span class="dv">10</span> <span class="dv">0</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">complexp</span> #c(<span class="dv">10</span> <span class="dv">0</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>NIL</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (make-complex <span class="dv">10</span> <span class="dv">0</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>#C(<span class="dv">10</span> <span class="dv">0</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">complexp</span> (make-complex <span class="dv">10</span> <span class="dv">0</span>))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
<h2 id="関数make-callname">関数<code>make-callname</code></h2>
<p><code>callname</code>オブジェクトを生成します。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-callname </span>(x) ...) -&gt; callname</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>入力: x function-name</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>出力: callname</span></code></pre></div>
<p>関数名を扱う<code>callname</code>オブジェクトを生成します。<br />
入力は<code>symbol</code>型か<code>(setf symbol)</code>型を受け取ります。</p>
<h1 id="型確認"><a id="system-call-4">■型確認</a></h1>
<p><code>npt-system</code>パッケージに存在する、型確認の関数仕様を示します。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> subtypep</span>!</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> parse-type</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> type-object</span></span></code></pre></div>
<h2 id="関数subtypep">関数<code>subtypep!</code></h2>
<p><code>subtypep</code>の結果を<code>symbol</code>で取得します。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> subtypep</span>! (left right) ...) -&gt; <span class="kw">symbol</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>入力: left type-specifier</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>入力: right type-specifier</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">symbol</span></span></code></pre></div>
<p>通常の<code>subtypep</code>とは違い、型が排他的かどうかも調査できます。<br />
返却値は下記の通りです。</p>
<ul>
<li>含まれる場合は<code>npt-system::include</code></li>
<li>排他的の場合は<code>npt-system::exclude</code></li>
<li>含まれず重複がある場合は<code>npt-system::false</code></li>
<li>判定不可能の場合は<code>npt-system::invalid</code></li>
</ul>
<h2 id="関数parse-type">関数<code>parse-type</code></h2>
<p>型をパースします。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> parse-type </span>(object) ...) -&gt; <span class="kw">type</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>入力: object type-specifier</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">type</span></span></code></pre></div>
<p>主な目的は型として形が正しいかどうかの調査です。<br />
返却値は型オブジェクトとなりますが、 通常のCommon Lispで型オブジェクトを利用することはありません。</p>
<h2 id="関数type-object">関数<code>type-object</code></h2>
<p>型オブジェクトからLispオブジェクトを生成します。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> type-object </span>(<span class="kw">type</span>) ...) -&gt; result</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">type</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>出力: result (<span class="kw">or</span> <span class="kw">cons</span> <span class="kw">symbol</span>)</span></code></pre></div>
<p>入力の型オブジェクトから、型の名前を生成します。</p>
<h1 id="メモリストリーム"><a id="system-call-5">■メモリストリーム</a></h1>
<p><code>npt-system</code>パッケージに存在する、メモリストリームの関数仕様を示します。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-input-stream</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-output-stream</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-memory-io-stream</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defmacro</span><span class="fu"> with-input-from-memory</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defmacro</span><span class="fu"> with-output-to-memory</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> get-output-stream-memory</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> memory-stream-p</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> </span>(<span class="kw">setf</span> memory-stream-p)</span></code></pre></div>
<h2 id="解説">解説</h2>
<p><code>memory-stream</code>は、ファイルの代替として用意されたストリームです。<br />
通常のファイルは<code>byte</code>をデータの単位としているため、 本ストリームも<code>(unsigned-byte 8)</code>をデータの基本単位としています。<br />
バイナリストリームであるため、例えば<code>read-char</code>関数のような 文字列型のストリーム関数は使用できず、 <code>read-byte</code>関数のようなバイナリ型の操作関数が使用できます。</p>
<p><code>memory-stream</code>は<code>open</code>関数の<code>filespec</code>に使用することができます。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">with-open-stream</span> (file (make-memory-input-stream #(<span class="ch">#x</span>48 #x65 #x6C #x6C #x6F)))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">with-open-file</span> (<span class="kw">stream</span> file)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">read-line</span> <span class="kw">stream</span>)))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>-&gt; <span class="st">&quot;Hello&quot;</span>, T</span></code></pre></div>
<p>ストリームが2つ重複して動作することになりますが、 ファイルポインタは<code>open</code>の方が優先され、 <code>memory-stream</code>の方は<code>open</code>関数によって操作されます。</p>
<p>上記の場合、<code>with-open-file</code>内部で実行された<code>(open file)</code>の<code>:input</code>オペレーションが、 <code>file</code>に格納されている<code>memory-stream</code>に対して、 最初に<code>(file-position file :start)</code>を実行します。<br />
<code>read-line</code>関数によってデータの読み込みが生じたときは、 <code>stream</code>のファイルポインタを前進させる処理を行うときに、 <code>memory-stream</code>のファイルポインタも同時に前進させます。</p>
<p><code>memory-stream</code>には下記の4つのパラメーターが存在します。</p>
<ul>
<li><code>:input</code> 初期値</li>
<li><code>:size</code> 内部バッファのbyte数</li>
<li><code>:array</code> 内部バッファ数の初期値</li>
<li><code>:cache</code> キャッシュの有無</li>
</ul>
<p><code>:input</code>は<code>memory-stream</code>の初期値です。<br />
必ず<code>(unsigned-byte 8)</code>の<code>sequence</code>でなければなりません。</p>
<p><code>:size</code>は<code>memory-sequence</code>が内部に保有するバッファのサイズです。<br />
省略時はコンパイル時に<code>LISP_DEBUG</code>が指定された場合は<code>64</code>byte、 それ以外の場合は<code>4096</code>byteです。<br />
指定した数のバッファが<code>memory-stream</code>内部でいくつも生成されることになります。</p>
<p><code>:array</code>は最初に保有する内部バッファの配列数です。<br />
省略時はコンパイル時に<code>LISP_DEBUG</code>が指定された場合は<code>4</code>個、 それ以外の場合は<code>8</code>個です。<br />
例えば、<code>4096</code>byte×<code>8</code>個以上のデータ数が要求された場合、 配列数<code>8</code>個から倍の<code>16</code>個、<code>32</code>個、<code>64</code>個、……、と拡張されていきます。</p>
<p><code>:cache</code>はキャッシュの有効・無効を選択します。<br />
この引数は開発時にデバッグとして使用するためのものです。<br />
キャッシュとは、<code>memory-stream</code>には何の影響もありませんが、 <code>open</code>関数に渡されたとき、生成された<code>file-stream</code>が キャッシュを使用するかどうかが選択されます。<br />
通常のファイルとは違い、<code>memory-stream</code>のデータは 全てメモリ上に配置されているため、 キャッシュ機能を<code>ON</code>にする必要はありません。<br />
省略時はコンパイル時に<code>LISP_DEBUG</code>が指定された場合は<code>T</code>（有効）、 それ以外の場合は<code>NIL</code>（無効）です。</p>
<p><code>memory-stream</code>は、入力・出力・入出力の3種類存在しますが、 全て同じオブジェクトを使用しているため いつでも種類を変更することができます。</p>
<h2 id="関数make-memory-input-stream">関数<code>make-memory-input-stream</code></h2>
<p>入力専用の<code>memory-stream</code>を生成します。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-memory-input-stream </span>(<span class="kw">sequence</span> &amp;key size <span class="kw">array</span> cache) ...) -&gt; <span class="kw">stream</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">sequence</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>入力: size (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">array</span> (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>入力: cache <span class="kw">t</span>  <span class="co">;; boolean</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">stream</span> input-memory-stream</span></code></pre></div>
<p><code>sequence</code>はストリーム内の初期値に使用されます。<br />
<code>size</code>は内部バッファのサイズであり、初期値は<code>4096</code>byteです。<br />
<code>array</code>は初期のバッファ保有数であり、初期値は<code>8</code>です。<br />
<code>cache</code>は開発用です。</p>
<h2 id="関数make-memory-output-stream">関数<code>make-memory-output-stream</code></h2>
<p>出力専用の<code>memory-stream</code>を生成します。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-memroy-output-stream </span>(&amp;key input size <span class="kw">array</span> cache) ...) -&gt; <span class="kw">stream</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>入力: input <span class="kw">sequence</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>入力: size (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">array</span> (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>入力: cache <span class="kw">t</span>  <span class="co">;; boolean</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">stream</span> output-memory-stream</span></code></pre></div>
<p><code>input</code>はストリーム内の初期値に使用されます。<br />
<code>size</code>は内部バッファのサイズであり、初期値は<code>4096</code>byteです。<br />
<code>array</code>は初期のバッファ保有数であり、初期値は<code>8</code>です。<br />
<code>cache</code>は開発用です。</p>
<h2 id="関数make-memory-io-stream">関数<code>make-memory-io-stream</code></h2>
<p>入出力対応の<code>memory-stream</code>を生成します。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-memroy-io-stream </span>(&amp;key input size <span class="kw">array</span> cache) ...) -&gt; <span class="kw">stream</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>入力: input <span class="kw">sequence</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>入力: size (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">array</span> (<span class="kw">or</span> <span class="kw">null</span> (<span class="kw">integer</span> <span class="dv">1</span> <span class="op">*</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>入力: cache <span class="kw">t</span>  <span class="co">;; boolean</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">stream</span> io-memory-stream</span></code></pre></div>
<p><code>input</code>はストリーム内の初期値に使用されます。<br />
<code>size</code>は内部バッファのサイズであり、初期値は<code>4096</code>byteです。<br />
<code>array</code>は初期のバッファ保有数であり、初期値は<code>8</code>です。<br />
<code>cache</code>は開発用です。</p>
<h2 id="マクロwith-input-from-memory">マクロ<code>with-input-from-memory</code></h2>
<p>マクロ<code>with-input-from-string</code>の<code>memory-stream</code>版です。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defmacro</span><span class="fu"> with-input-from-memory</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  ((<span class="kw">stream</span> <span class="kw">vector</span> &amp;key size <span class="kw">array</span>) declaration* form*) ...)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  -&gt; result</span></code></pre></div>
<p><code>string-stream</code>とは違い、引数<code>index</code>がありません。</p>
<h2 id="マクロwith-output-to-memory">マクロ<code>with-output-to-memory</code></h2>
<p>マクロ<code>with-output-to-string</code>の<code>memory-stream</code>版です。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defmacro</span><span class="fu"> with-output-to-memory</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  ((var &amp;key input size <span class="kw">array</span>) declaration* form*) ...)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  -&gt; result</span></code></pre></div>
<p>返却値は、<code>get-output-stream-memory</code>の戻り値が使用されます。<br />
<code>string-stream</code>とは違い、第2引数の<code>array</code>は対応していません。<br />
戻り値は<code>(array (unsigned-byte 8))</code>の配列になります。</p>
<h2 id="関数get-output-stream-memory">関数<code>get-output-stream-memory</code></h2>
<p><code>memory-stream</code>が保有している全てのデータを配列にして返却します。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> get-output-stream-memory </span>(<span class="kw">stream</span>) ...) -&gt; <span class="kw">vector</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">stream</span> memory-stream</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">vector</span> (<span class="kw">array</span> (<span class="kw">unsigned-byte</span> <span class="dv">8</span>))</span></code></pre></div>
<p>引数は出力用の<code>memory-stream</code>だけではなく、入力と入出力も受け付けます。<br />
<code>string-stream</code>とは違い、値を出力した後でも内容は削除されません。<br />
返却値は<code>(array (unsigned-byte 8))</code>の配列になります。</p>
<h2 id="アクセス関数memory-stream-p">アクセス関数<code>memory-stream-p</code></h2>
<p>引数が<code>memory-stream</code>かどうかを調べます。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> memory-stream-p </span>(object) ...) -&gt; result</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>入力: object</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>出力: result (<span class="kw">member</span> <span class="bu">:input</span> <span class="bu">:output</span> <span class="bu">:io</span> <span class="kw">nil</span>)</span></code></pre></div>
<p><code>memory-stream</code>ではない場合は、<code>nil</code>を返却します。<br />
<code>input-memory-stream</code>の場合は、<code>:input</code>を返却します。<br />
<code>output-memory-stream</code>の場合は、<code>:output</code>を返却します。<br />
<code>io-memory-stream</code>の場合は、<code>:ioを</code>返却します。</p>
<h2 id="アクセス関数setf-memory-stream-p">アクセス関数<code>(setf memory-stream-p)</code></h2>
<p><code>memory-stream</code>の種類を変更します。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> </span>(<span class="kw">setf</span> memory-stream-p) (result <span class="kw">stream</span>) ...) -&gt; result</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">stream</span> memory-stream</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>入力: result  (<span class="kw">member</span> <span class="bu">:input</span> <span class="bu">:output</span> <span class="bu">:io</span>)</span></code></pre></div>
<p>例えば、入力<code>memory-stream</code>を、入出力<code>memory-stream</code>に変更できます。<br />
設定値が<code>:input</code>で入力、<code>:output</code>で出力、<code>:io</code>で入出力に変更します。</p>
<p>それぞれの<code>memory-stream</code>は全て同一のオブジェクトであり、 種類を変更することによって、<code>stream</code>の入出力関数 （例えば<code>read-byte</code>など）の使用可否を変更できます。</p>
<h3 id="使用例">使用例</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">setq</span> x (make-memory-output-stream))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>#&lt;STREAM MEMORY-OUTPUT <span class="ch">#x</span>8012801e0&gt;</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">write-sequence</span> &#39;(<span class="dv">65</span> <span class="dv">66</span> <span class="dv">67</span>) x)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">65</span> <span class="dv">66</span> <span class="dv">67</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">file-position</span> x <span class="bu">:start</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">with-open-file</span> (s x) (<span class="kw">read-line</span> s))</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  -&gt; ★error</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (memory-stream-p x)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>:OUTPUT</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">setf</span> (memory-stream-p x) <span class="bu">:input</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>:INPUT</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (<span class="kw">with-open-file</span> (s x) (<span class="kw">read-line</span> s))</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;ABC&quot;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="op">*</span></span></code></pre></div>
<h1 id="ソート"><a id="system-call-6">■ソート</a></h1>
<p><code>npt-system</code>パッケージに存在する、ソートの関数仕様を示します。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> simple-sort</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> bubble-sort</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> quick-sort</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> merge-sort</span></span></code></pre></div>
<h2 id="関数simple-sort">関数<code>simple-sort</code></h2>
<p>選択ソートを行います。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> simple-sort </span>(<span class="kw">sequence</span> call &amp;key key) ...) -&gt; result</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">sequence</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>入力: call 関数</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>入力: key 関数</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>出力: result <span class="kw">sequence</span></span></code></pre></div>
<p>不安定であり、実行コストが<code>O(n^2)</code>のソートを行います。</p>
<h2 id="関数bubble-sort">関数<code>bubble-sort</code></h2>
<p>バブルソートを行います。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> bubble-sort </span>(<span class="kw">sequence</span> call &amp;key key) ...) -&gt; result</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">sequence</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>入力: call 関数</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>入力: key 関数</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>出力: result <span class="kw">sequence</span></span></code></pre></div>
<p>安定であり、実行コストが<code>O(n^2)</code>のソートを行います。</p>
<h2 id="関数quick-sort">関数<code>quick-sort</code></h2>
<p>クイックソートを行います。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> quick-sort </span>(<span class="kw">sequence</span> call &amp;key key) ...) -&gt; result</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">sequence</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>入力: call 関数</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>入力: key 関数</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>出力: result <span class="kw">sequence</span></span></code></pre></div>
<p>不安定であり、実行コストが<code>O(n log n)</code>のソートを行います。</p>
<h2 id="関数merge-sort">関数<code>merge-sort</code></h2>
<p>マージソートを行います。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> merge-sort </span>(<span class="kw">sequence</span> call &amp;key key) ...) -&gt; result</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">sequence</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>入力: call 関数</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>入力: key 関数</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>出力: result <span class="kw">sequence</span></span></code></pre></div>
<p>安定であり、実行コストが<code>O(n log n)</code>のソートを行います。</p>
<h1 id="paperオブジェクト"><a id="system-call-7">■Paperオブジェクト</a></h1>
<p><code>npt-system</code>パッケージに存在する、Paperオブジェクトの関数仕様を示します。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> make-paper</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> info-paper</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> array-paper</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> body-paper</span></span></code></pre></div>
<h2 id="関数make-paper">関数<code>make-paper</code></h2>
<p>Paperオブジェクトを生成します。</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> make-paper </span>(<span class="kw">array</span> body &amp;key <span class="kw">fill</span> <span class="kw">type</span>) ...) -&gt; result</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">array</span> サイズ</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>入力: body サイズ</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">fill</span> 初期値</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">type</span> User値</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>出力: result paper</span></code></pre></div>
<p>Paperオブジェクトとは、<code>simple-vector</code>と バイト形式のバッファをあわせもつオブジェクトです。<br />
<code>array</code>が<code>nil</code>か<code>0</code>の場合は、body形式で生成されます。<br />
<code>body</code>が<code>nil</code>か<code>0</code>の場合は、array形式で生成されます。<br />
<code>array</code>と<code>body</code>が1以上の場合は、array-body形式で生成されます。<br />
array-body形式の場合、<code>array</code>と<code>body</code>はともに<code>#xFFFF</code>以下にして下さい。</p>
<p><code>:fill</code>は、body形式の初期値を指定します。<br />
<code>nil</code>か、<code>t</code>か、<code>0x00</code>～<code>#xFF</code>の整数を指定します。<br />
<code>nil</code>の場合は初期化を行いません。<br />
<code>t</code>は0と同じです。</p>
<p><code>:type</code>は、User値です。<br />
User値とは、形式に関係なく<code>#x00</code>～<code>#xFF</code>までの値を保有する1byteの領域の事です。<br />
デフォルト値は0です。<br />
Paperオブジェクトの種類として利用することをお勧めします。</p>
<h2 id="関数info-paper">関数<code>info-paper</code></h2>
<p>Paperオブジェクトに対して、下記の操作を行います。</p>
<ul>
<li>User値の取得と設定</li>
<li>arrayとbodyの一括取得</li>
<li>arrayとbodyのサイズ取得</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> info-paper </span>(paper <span class="kw">symbol</span> &amp;optional <span class="kw">second</span>) ...) -&gt; result</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>入力: paper</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">symbol</span>, (<span class="kw">member</span> <span class="kw">list</span> <span class="kw">vector</span> <span class="kw">type</span> <span class="kw">length</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">second</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>出力: result</span></code></pre></div>
<p><code>symbol</code>が<code>type</code>のときは、User値の取得と設定を行います。<br />
<code>second</code>が指定されていなかった場合は取得です。<br />
<code>second</code>が指定された場合は設定です。</p>
<p><code>symbol</code>が<code>list</code>のときは、arrayかbodyの内容をlistで返却します。<br />
<code>second</code>が指定されないか<code>nil</code>の場合は、全てのarrayが返却されます。<br />
<code>second</code>が<code>nil</code>ではない場合は、全てのbodyが返却されます。</p>
<p><code>symbol</code>が<code>vector</code>のときは、arrayかbodyの内容をvectorで返却します。<br />
<code>second</code>が指定されないか<code>nil</code>の場合は、全てのarrayが返却されます。<br />
<code>second</code>が<code>nil</code>ではない場合は、全てのbodyが返却されます。<br />
bodyのときは、<code>(unsigned-byte 8)</code>形式のspecialized arrayで返却されます。</p>
<p><code>symbol</code>が<code>length</code>のときは、arrayかbodyの長さを返却します。<br />
<code>second</code>が指定されないか<code>nil</code>の場合は、arrayの長さが返却されます。<br />
<code>second</code>が<code>nil</code>ではない場合は、body長さが返却されます。</p>
<h2 id="関数array-paper">関数<code>array-paper</code></h2>
<p>Paperオブジェクトに対して、arrayの設定と取得を行います。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> array-paper </span>(paper index &amp;optional value) ...) -&gt; result</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>入力: paper</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>入力: index, (<span class="kw">integer</span> <span class="dv">0</span> <span class="op">*</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>入力: value</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>出力: result</span></code></pre></div>
<p><code>value</code>が指定されていなかった場合は取得です。<br />
<code>value</code>が指定された場合は設定です。</p>
<h2 id="関数body-paper">関数<code>body-paper</code></h2>
<p>Paperオブジェクトに対して、bodyの設定と取得を行います。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> body-paper </span>(paper index &amp;optional value) ...) -&gt; result</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>入力: paper</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>入力: index, (<span class="kw">integer</span> <span class="dv">0</span> <span class="op">*</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>入力: value</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>出力: result</span></code></pre></div>
<p><code>value</code>が指定されていなかった場合は取得です。<br />
<code>value</code>が指定された場合は設定です。</p>
<h1 id="その他の関数"><a id="system-call-8">■その他の関数</a></h1>
<p><code>npt-system</code>パッケージに存在する、その他の関数の仕様を示します。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> package-export-list</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> large-number</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> equal-random-state</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> remove-file</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> remove-directory</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> byte-integer</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> fpclassify</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-set</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-get</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="kw">defun</span><span class="fu"> eastasian-width</span></span></code></pre></div>
<h2 id="関数package-export-list">関数<code>package-export-list</code></h2>
<p><code>package</code>の<code>export</code>リストを取得します。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> package-export-list </span>(package-designer) ...) -&gt; <span class="kw">list</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>入力: package-designer</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">list</span></span></code></pre></div>
<p>パッケージで<code>export</code>されているsymbolの名前のリストを取得します。</p>
<h2 id="関数large-number">関数<code>large-number</code></h2>
<p>数値を英語で表したときの、3桁区切りのカンマに対応する表記を取得します。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> large-number </span>(value &amp;optional (cardinal <span class="kw">t</span>)) ...) -&gt; <span class="kw">string</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>入力: value 数値</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>入力: cardinal <span class="kw">boolean</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">string</span></span></code></pre></div>
<p>数値を3桁区切りにして、右から<code>n-1</code>番目に対応する文字列を返却します。<br />
下記の数値を考えたとき、</p>
<pre><code>1,000,000</code></pre>
<p>引数0が右のカンマに対応するので<code>thousand</code>です。<br />
引数1が右から2番目に対応するので<code>million</code>です。<br />
引数<code>cardinal</code>が<code>nil</code>で序数になります。</p>
<h3 id="実行例-11">実行例</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (large-number <span class="dv">0</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;thousand&quot;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (large-number <span class="dv">1</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;million&quot;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (large-number <span class="dv">1000</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;millinillion&quot;</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (large-number <span class="dv">5555</span>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;quintilliquinquinquagintaquingentillion&quot;</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (large-number <span class="dv">5555</span> <span class="kw">nil</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;quintilliquinquinquagintaquingentillionth&quot;</span></span></code></pre></div>
<h2 id="関数equal-random-state">関数<code>equal-random-state</code></h2>
<p><code>random-state</code>が等しいかどうかを調べます。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> equal-random-state </span>(a b) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>入力: a <span class="kw">random-state</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>入力: b <span class="kw">random-state</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<h2 id="関数remove-file">関数<code>remove-file</code></h2>
<p>ファイルを削除します。</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> remove-file </span>(<span class="kw">pathname</span> &amp;optional (<span class="kw">error</span> <span class="kw">t</span>)) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">pathname</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>入力: errorp</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>標準関数の<code>delete-file</code>と違い、引数<code>errorp</code>で失敗の場合を扱うことができます。<br />
標準では<code>errorp</code>が<code>t</code>のため、<code>delete-file</code>と同じです。<br />
<code>errorp</code>が<code>nil</code>の場合は、削除に成功すると<code>t</code>を返却し、失敗したら<code>nil</code>を返却します。</p>
<h2 id="関数remove-directory">関数<code>remove-directory</code></h2>
<p>ディレクトリを削除します。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> remove-directory </span>(<span class="kw">pathname</span> &amp;optional (<span class="kw">error</span> <span class="kw">t</span>)) ...) -&gt; <span class="kw">boolean</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">pathname</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>入力: errorp</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p><code>errorp</code>が<code>t</code>のときは、削除に失敗したときに<code>error</code>が発生します。<br />
<code>errorp</code>が<code>nil</code>のときは、削除に成功すると<code>t</code>を返却し、失敗したら<code>nil</code>を返却します。</p>
<h2 id="関数byte-integer">関数<code>byte-integer</code></h2>
<p>CPUのエンディアンを考慮して、<code>unsigned-byte</code>の値を連結して整数を返却します。</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> byte-integer </span>(&amp;<span class="kw">rest</span> args) ...) -&gt; result</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>入力: args (<span class="kw">unsigned-byte</span> <span class="dv">8</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>出力: result (<span class="kw">integer</span> <span class="dv">0</span> <span class="op">*</span>)</span></code></pre></div>
<p>例えば、非符号付き16bit整数<code>uint16_t</code>を考えたとき、 バイト列<code>#x00 #x01</code>がいくつになるかを取得するときに使用します。<br />
CPUがbig endianの場合は、上位バイトが<code>#x00</code>で、下位バイトが<code>#x01</code>となるため、 返却値は<code>#x01=1</code>です。<br />
一方、CPUがlittle endianの場合は、返却値が<code>#x0100=256</code>となります。</p>
<h2 id="関数fpclassify">関数<code>fpclassify</code></h2>
<p>浮動小数値の状態と符号を取得します。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> fpclassify </span>(<span class="kw">float</span>) ...) -&gt; <span class="kw">type</span>, sign</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">float</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>出力: result <span class="kw">symbol</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>出力: result 1か<span class="dv">-1</span></span></code></pre></div>
<p><code>float</code>が無限大のとき、<code>type</code>は<code>npt-system::fp-infinite</code>です。<br />
<code>float</code>が非数のとき、<code>type</code>は<code>npt-system::fp-nan</code>です。<br />
<code>float</code>が通常の数のとき、<code>type</code>は<code>npt-system::fp-normal</code>です。<br />
<code>float</code>がデノーマル数のとき、<code>type</code>は<code>npt-system::fp-subnormal</code>です。<br />
<code>float</code>がゼロのとき、<code>type</code>は<code>npt-system::fp-zero</code>です。<br />
<code>float</code>の符号が正のとき、<code>sign</code>は<code>1</code>です。<br />
<code>float</code>の符号が負のとき、<code>sign</code>は<code>-1</code>です。</p>
<p>本来、Common Lispでは、無限大と非数を扱うことはできず、 発生した時点で<code>arithmetic-error</code> conditionが発生します。</p>
<h2 id="関数eastasian-set">関数<code>eastasian-set</code></h2>
<p>East Asian Widthのカテゴリ別に、文字数を設定します。</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-set </span>(string-designer intplus &amp;optional <span class="kw">error</span>) ...) -&gt; <span class="kw">boolean</span>) */</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>入力: string-designer</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>入力: intplus (<span class="kw">integer</span> <span class="dv">0</span> <span class="op">*</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>入力: <span class="kw">error</span> <span class="kw">boolean</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>East Asian Widthとは、日本語で言う半角/全角を定義したものです。<br />
入力の<code>string-designer</code>は、<code>N</code>, <code>A</code>, <code>H</code>, <code>W</code>, <code>F</code>, <code>NA</code>の6種類指定できます。<br />
それぞれのカテゴリに対して、<code>intplus</code>で指定した文字数を設定します。</p>
<p><code>intplus</code>には、半角<code>1</code>か全角<code>2</code>を指定することになると思います。<br />
<code>error</code>が<code>t</code>のときは、該当するカテゴリが無かったらエラーが発生します。<br />
正常終了時には<code>t</code>が返却されます。</p>
<h2 id="関数eastasian-get">関数<code>eastasian-get</code></h2>
<p>East Asian Widthのカテゴリに対応する文字数を取得します。</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-get </span>(string-designer) ...) -&gt; (<span class="kw">values</span> IntplusNull <span class="kw">symbol</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>入力: string-designer</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>出力: intplusNull 文字数かnil</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">symbol</span> カテゴリのsymbol</span></code></pre></div>
<p>East Asian Widthとは、日本語で言う半角/全角を定義したものです。<br />
入力の<code>string-designer</code>は、<code>N</code>, <code>A</code>, <code>H</code>, <code>W</code>, <code>F</code>, <code>NA</code>の6種類指定できます。<br />
それぞれのカテゴリに対応した文字数が返却されます。<br />
エラーの場合は<code>NIL</code>が返却されます。</p>
<h2 id="関数eastasian-width">関数<code>eastasian-width</code></h2>
<p>East Asian Widthを考慮した長さを返却します。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">defun</span><span class="fu"> eastasian-width </span>(var) ...) -&gt; (<span class="kw">values</span> IntplusNull <span class="kw">boolean</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>入力: var  (<span class="kw">or</span> <span class="kw">integer</span> <span class="kw">character</span> <span class="kw">string</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>出力: IntplusNull 文字数かnil</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>出力: <span class="kw">boolean</span></span></code></pre></div>
<p>入力<code>var</code>には、文字、数値、文字列を指定できます。<br />
数値の場合は文字コードとみなします。</p>
<h3 id="実行例-12">実行例</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode lisp"><code class="sourceCode commonlisp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (eastasian-width <span class="ch">#\A</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (eastasian-width <span class="ch">#\u</span>3042)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (eastasian-width <span class="ch">#x</span>3044)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>T</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="op">*</span> (eastasian-width <span class="st">&quot;あいうHello&quot;</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>T</span></code></pre></div>
</body>
</html>
